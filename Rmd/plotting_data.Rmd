---
title: "Plotting Data"
author: "Anna Finch"
date: "6/16/2022"
output: html_document
---

```{r setup, include=FALSE}
library("dplyr")
library("ggplot2")
library("tidyverse")
library(huxtable)

root <- rprojroot::find_rstudio_root_file()
dir2 <- "//data//processed//"
path_out = paste0(root,dir2)
pig_dat <- read.csv(paste0(path_out,"combined_pig_dat.csv")) %>% 
    mutate(season = factor(season, levels = c("W", "Sp", "Su", "F")))



```

```{r concentration vs time}
ggplot(pig_dat, aes(x=date_time_utc, y=allo)) +
    geom_point(size=2) +
    theme_classic()
```

```{r scatter plots}
ggplot(pig_dat, aes(x=tot_chl_a, y=fuco)) +
    geom_point(color = "red") +
    facet_wrap(~season)


```

```{r histogram}
# # hist_dat <- 
#     pig_dat %>%
#     pivot_longer(cols = tot_chl_a:tchl_a_tpg, names_to = "pigment",
#                  values_to = "value") %>%
#     group_by(pigment) %>%
#     ggplot(aes(value)) +
#     geom_histogram() 
#     # scale_x_continuous(limits = c(0,1)) +
#     # scale_y_continuous(limits = c(0,500)) 
#     # facet_wrap(~pigment)

pig_long <- pig_dat %>%
    pivot_longer(cols = tot_chl_a:tchl_a_tpg, names_to = "pigment",
                 values_to = "value") %>%
    select(season, pigment, value)
 pig_hist <- lapply(unique(pig_long$pigment), function(i) {
  ggplot(pig_long[pig_long$pigment==i,], aes(value, fill = season)) +
    geom_histogram(position = "dodge") +
    labs(title=i)
})
 pig_hist
```

```{r violin, boxplot, jitter}
p <- pig_dat %>% 
    # filter(month == "December") %>%
    ggplot(aes(x=season, y=zea))+
    geom_violin(trim = TRUE) +
    geom_jitter(width = 0.1, size=0.5, alpha = 0.5) +
    theme_bw() +
    scale_y_continuous(expand = c(0,0)) +
    facet_wrap(facet = ~name_of_water_body)
p
p2 <-ggplot(filter(pig_dat, month == "December"), 
            aes(x=month, y=tot_chl_a)) +
    geom_jitter()
p2

ggplot(pig_dat, aes(x = season, y=fuco/tot_chl_a, color = name_of_water_body)) +
    geom_violin()     
```


```{r size-fractionation}
ggplot(pig_dat, aes(x=season, y=micro, color=name_of_water_body)) +
    geom_boxplot() +
    ylim(0,5)

ggplot(pig_dat, aes(x=season, y=nano, color=name_of_water_body)) +
    geom_boxplot() +
    ylim(0,0.5)

ggplot(pig_dat, aes(x=season, y=pico, color=name_of_water_body)) +
    geom_boxplot() +
    ylim(0,1.5)

pig_dat %>% 
    group_by(season) %>% 
    summarise(avg_f_micro = mean(f_micro), sd_f_micro = sd(f_micro), 
              avg_f_nano = mean(f_nano), sd_f_nano = sd(f_nano),
              avg_f_pico = mean(f_pico), sd_f_pico = sd(f_pico)) %>% 
    colnames(c("Season", "f"))
```

```{r plotting-chemtax-data}
cmtx_longer <- cmtx_avgs %>% 
    pivot_longer(cols = chloro:pras, names_to = "func_type", values_to = "conc")

ggplot(cmtx_longer, aes(fill = func_type, y=conc, x=hplc_gsfc_id))+ 
    geom_bar(position="fill", stat="identity") +
    facet_grid(.~season)


```

```{r photoprotective-index}
pigm_pi <- pig_dat %>% 
    #PPC in spreadsheets and PPC in Lee et al 2022 are calculated differently. Which should I use?
    mutate(pi = ppc/tot_chl_a)

ggplot(pigm_pi, aes(x=season, y=pi, fill = season)) +
    geom_boxplot() +
    theme_classic() +
    theme(legend.position = "none", text=element_text(family="serif", size=12)) +
    labs(y = "Photoprotection Index (PI)", x= "Season")


ggplot(pigm_pi, aes(x=psc, y=ppc, shape = season, color=season)) +
    geom_point() +
    geom_abline(slope=1, intercept=0) +
    theme_classic() +
    labs(y= "PPCs", x="PSCs")+
    theme(text=element_text(family="serif")) +
    scale_y_continuous(expand = c(0,0)) +
    scale_x_continuous(expand = c(0,0))
    
```


